<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>General Store</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">

    <style>
        body {
            padding: 0;
        }

        .float-right {
            float: right;
        }

        .form-control1 {
            width: 40%;
            float: right;
        }

        #main-header {
            height: 177px;
            background-color: green;
            color: white;
            font-size: 40px;
        }

        #filter {
            width: 77%;
            margin-top: 10%;
        }
    </style>
</head>
</head>

<header id="main-header" class="bg-success text-white p-4 mb-3">
    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <h1 id="header-title">Groceries Items</h1>
            </div>
        </div>
    </div>
</header>


<div class="container">
    <div id="main" class="card card-body">
        <h2 class="title">Add Items</h2>
        <form id="addForm" class="form-inline mb-3">
            <input type="text" class="form-control mr-2" id="item" placeholder="ItemName">
            <input type="text" class="form-control " id="description" placeholder="Description">
            <input type="text" class="form-control mr-2" id="Price" placeholder="Price">
            <input type="text" class="form-control " id="Quantity" placeholder="Quantity">
            <input type="submit" class="btn btn-dark" value="Submit">
        </form>
        <h2 class="title">Items</h2>

        <ul id="items" class="list-group">
            <!-- <li class="list-group-item">Item 1 <button id="btn1">Buy1</button>  <button id="btn2">Buy2</button> <button id="btn3">Buy3</button>
             </li>
            <li class="list-group-item">Item 2 <button id="btn1">Buy1</button>  <button id="btn2">Buy2</button> <button id="btn3">Buy3</button>
            </li2>
            <li class="list-group-item">Item 3 <button id="btn1">Buy1</button>  <button id="btn2">Buy2</button> <button id="btn3">Buy3</button>
            </li>2
            <li class="list-group-item">Item 4 <button id="btn1">Buy1</button>  <button id="btn2">Buy2</button> <button id="btn3">Buy3</button>
            </li> -->
        </ul>
    </div>
</div>

<body>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"></script>
    <script>
        const details = document.getElementById('addForm');
        const item = document.getElementById('item');
        const description = document.getElementById('description');
        const Price = document.getElementById('Price');
        const Quantity = document.getElementById('Quantity');
        const items = document.getElementById('items');
        details.addEventListener(('submit'), myFormAlldetails);

        // Main creation 
        async function myFormAlldetails(event) {
            event.preventDefault();

            const obj = {
                ItemName: item.value,
                Itemdescription: description.value,
                ItemPrice: Price.value,
                ItemQuantity: Quantity.value,
            }

            try {
                const response = await axios.post('https://crudcrud.com/api/6c1caca856644ac490a92f6060643a79/GroceriesItems', obj)
                addItems(response.data)
            }
            catch (error) {
                console.log(error);
            }

        }

        // To Add Groceries Item
        function addItems(obj) {
            const li = document.createElement('li');
            // li.id = obj._id;
            // console.log(li.id);
            //li.appendChild(document.createTextNode(`${obj.ItemName} ${obj.Itemdescription} ${obj.ItemPrice} ${obj.ItemQuantity}`))
            //li.appendChild(document.createTextNode(`<span>${obj.ItemName}</span> <span>${obj.Itemdescription}</span> <span>${obj.ItemPrice}</span> <span class="qty">${obj.ItemQuantity}</span>`));
            li.innerHTML = `<span>${obj.ItemName}</span> <span>${obj.Itemdescription}</span> <span>${obj.ItemPrice}</span> <span class="qty">${obj.ItemQuantity}</span>`;

            li.appendChild(BuyBtnOne(obj));
            li.appendChild(BuyBtnTwo(obj));
            li.appendChild(BuyBtnThree(obj));
            li.appendChild(deleteBtn(obj));
            items.appendChild(li);
        }



        // Buy 1 Button
        function BuyBtnOne(obj) {

            const btn1 = document.createElement('input')
            btn1.type = 'button'
            btn1.style.background = 'green'
            btn1.style.color = 'black'
            btn1.style.marginLeft = '20px'
            btn1.style.marginTop = '15px'
            btn1.value = 'BUY 1'

            btn1.onclick = async () => {
                const id1 = obj._id;
                const listItem = btn1.parentNode;

                try {
                    if (obj.ItemQuantity > 0) {
                        const response = await axios.put(`https://crudcrud.com/api/6c1caca856644ac490a92f6060643a79/GroceriesItems/${id1}`, { ItemName: obj.ItemName, Itemdescription: obj.Itemdescription, ItemPrice: obj.ItemPrice, ItemQuantity: obj.ItemQuantity })
                        obj.ItemQuantity = obj.ItemQuantity - 1;
                        const qtyEl = listItem.querySelector(`.qty`)
                        qtyEl.innerHTML = obj.ItemQuantity;
                    }
                    else {
                        alert('Items out of stock!');
                    }
                }
                catch (error) {
                    console.log(error);
                }
            }

            return btn1;
        }

        // Buy 2 Button 

        function BuyBtnTwo(obj) {

            const btn2 = document.createElement('input')
            btn2.type = 'button'
            btn2.style.background = 'green'
            btn2.style.color = 'black'
            btn2.style.marginLeft = '20px'
            btn2.style.marginTop = '15px'
            btn2.value = 'BUY 2'

            btn2.onclick = async () => {
                try {
                    const id2 = obj._id;
                    const listItem = btn2.parentNode;
                    if (obj.ItemQuantity > 0) {
                        const response = await axios.put(`https://crudcrud.com/api/6c1caca856644ac490a92f6060643a79/GroceriesItems/${id2}`, { ItemName: obj.ItemName, Itemdescription: obj.Itemdescription, ItemPrice: obj.ItemPrice, ItemQuantity: obj.ItemQuantity - 2 })
                        obj.ItemQuantity = obj.ItemQuantity - 2;
                        const qtyE2 = listItem.querySelector('.qty');
                        qtyE2.innerHTML = obj.ItemQuantity;
                    }
                    else {
                        alert('Items out of stock')
                    }
                }
                catch (error) {
                    console.log(error);
                }

            }
            return btn2;
        }

        // Buy 1 Button

        function BuyBtnThree(obj) {

            const btn3 = document.createElement('input')
            btn3.type = 'button'
            btn3.style.background = 'green'
            btn3.style.color = 'black'
            btn3.style.marginLeft = '20px'
            btn3.style.marginTop = '15px'
            btn3.value = 'BUY 3'

            btn3.onclick = async () => {
                const id3 = obj._id;
                const listItem = btn3.parentNode;
                try {
                    if (obj.ItemQuantity > 0) {

                        const response = await axios.put(`https://crudcrud.com/api/6c1caca856644ac490a92f6060643a79/GroceriesItems/${id3}`, { ItemName: obj.ItemName, Itemdescription: obj.Itemdescription, ItemPrice: obj.ItemPrice, ItemQuantity: obj.ItemQuantity - 3 })
                        obj.ItemQuantity = obj.ItemQuantity - 3;
                        const qtyE3 = listItem.querySelector('.qty');
                        qtyE3.innerHTML = obj.ItemQuantity;
                    }
                    else {
                        alert('Items out of stock')
                    }
                }
                catch (error) {
                    console.log(error)
                }

            }

            return btn3;
        }

        function deleteBtn(obj) {
            const deleteBtn = document.createElement('input')
            deleteBtn.type = 'button';
            // deleteBtn.value = '❌'
            deleteBtn.value = 'Delete Item'
            deleteBtn.style.background = 'red'
            deleteBtn.style.color = 'black'
            deleteBtn.style.marginLeft = '15px'
            const id = obj._id;

            deleteBtn.onclick = async () => {
                try {
                    const ListItem = deleteBtn.parentNode;
                    const response = await axios.delete(`https://crudcrud.com/api/6c1caca856644ac490a92f6060643a79/GroceriesItems/${id}`)
                    items.removeChild(ListItem);
                }
                catch (error) {
                    console.log(error);
                }

            }
            return deleteBtn;
        }

        // When we refresh the window

        window.addEventListener(('load'), BrowserRefresh);

        async function BrowserRefresh() {
            try {
                const response = await axios.get('https://crudcrud.com/api/6c1caca856644ac490a92f6060643a79/GroceriesItems')
                for (var i = 0; i < response.data.length; i++) {
                    const data = response.data[i];
                    addItems(data)
                }
            }
            catch (error) {
                console.log(error);
            }
        }



    </script>

</body>

</html>